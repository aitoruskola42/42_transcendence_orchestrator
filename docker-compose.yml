services:
  api_gateway:
    container_name: api_gateway
    build: ./api_gateway
    image: api_gateway
    ports:
      - 49998:80
    restart: unless-stopped
    networks:
      - backend_net

  frontend:
    container_name: frontend
    build: ./frontend
    image: frontend
    ports:
      - 49999:80
    volumes:
      - ./frontend/app:/usr/share/nginx/html
    restart: unless-stopped

  user_management_api:
    container_name: user_management_api
    build: ./user_management
    image: user_management_api
    ports:
      - 50000:8080
    volumes:
      - ./user_management/app:/usr/src/app
    depends_on:
      - user_management_db
    restart: unless-stopped
    networks:
      - user_management_net
      - backend_net

  user_management_db:
    container_name: user_management_db
    image: postgres
    environment:
      POSTGRES_USER: root
      POSTGRES_PASSWORD: root
      POSTGRES_DB: api-db
    restart: unless-stopped
    networks:
      - user_management_net

  multiplayer_service:
    container_name: multiplayer_service
    build: ./multiplayer
    image: multiplayer_service
    ports:
      - 50001:8080
    volumes:
      - ./multiplayer/app/multiplayer_service:/usr/src/app
    restart: unless-stopped
    networks:
      - backend_net

  chat_service:
    container_name: chat_service
    build: ./chat
    image: chat_service
    ports:
      - 50002:8080
    depends_on:
      - chat_db
    volumes:
      - ./chat/app/chat_service:/usr/src/app
    restart: unless-stopped
    networks:
      - chat_net
      - backend_net

  chat_db:
    container_name: chat_db
    image: postgres
    environment:
      POSTGRES_USER: root
      POSTGRES_PASSWORD: root
      POSTGRES_DB: chat-db
    restart: unless-stopped
    networks:
      - chat_net

networks:
  user_management_net:
    driver: bridge
  chat_net:
    driver: bridge
  backend_net:
    driver: bridge
